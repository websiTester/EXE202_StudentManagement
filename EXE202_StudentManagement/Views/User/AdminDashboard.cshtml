@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    Layout = "_AdminLayout";
}

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Quản Lý</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* light gray background */
        }

        .chart-container {
            position: relative;
            height: 350px;
            width: 100%;
        }
    </style>
</head>
<body class="antialiased text-gray-800">
    <div class="min-h-screen p-4 sm:p-6 lg:p-8">
        <div class="max-w-7xl mx-auto">

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- Total Users Card -->
                <div class="bg-white p-6 rounded-2xl shadow-sm">
                    <div class="flex items-start justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-500">Tổng Người Dùng</p>
                            <p id="total-users" class="text-3xl font-bold mt-2">0</p>
                        </div>
                        <div class="bg-blue-100 text-blue-600 p-3 rounded-xl">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
                        </div>
                    </div>
                    <div class="mt-4 flex space-x-2">
                        <button id="filter-all" class="filter-btn bg-blue-500 text-white text-xs font-semibold px-3 py-1 rounded-full">Tất cả</button>
                        <button id="filter-student" class="filter-btn bg-gray-200 text-gray-700 text-xs font-semibold px-3 py-1 rounded-full">Học viên</button>
                        <button id="filter-teacher" class="filter-btn bg-gray-200 text-gray-700 text-xs font-semibold px-3 py-1 rounded-full">Giảng viên</button>
                    </div>
                </div>

                <!-- Total Visits Card -->
                <div class="bg-white p-6 rounded-2xl shadow-sm">
                    <div class="flex items-start justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-500">Lượt Truy Cập</p>
                            <p id="total-visits" class="text-3xl font-bold mt-2">0</p>
                        </div>
                        <div class="bg-green-100 text-green-600 p-3 rounded-xl">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" /></svg>
                        </div>
                    </div>
                    <p class="text-xs text-gray-400 mt-4">Tổng số lượt đăng nhập vào hệ thống.</p>
                </div>

                <!-- Total Classes Card -->
                <div class="bg-white p-6 rounded-2xl shadow-sm">
                    <div class="flex items-start justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-500">Tổng Lớp Học</p>
                            <p id="total-classes" class="text-3xl font-bold mt-2">0</p>
                        </div>
                        <div class="bg-yellow-100 text-yellow-600 p-3 rounded-xl">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v11.494m-9-5.747h18" /></svg>
                        </div>
                    </div>
                    <p class="text-xs text-gray-400 mt-4">Số lớp học đang hoạt động.</p>
                </div>

                <!-- Total Courses Card -->
                <div class="bg-white p-6 rounded-2xl shadow-sm">
                    <div class="flex items-start justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-500">Tổng Khóa Học</p>
                            <p id="total-courses" class="text-3xl font-bold mt-2">0</p>
                        </div>
                        <div class="bg-indigo-100 text-indigo-600 p-3 rounded-xl">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v11.494m-9-5.747h18" /></svg>
                        </div>
                    </div>
                    <p class="text-xs text-gray-400 mt-4">Tổng số khóa học có sẵn.</p>
                </div>
            </div>

            <!-- Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Users Chart -->
                <div class="bg-white p-6 rounded-2xl shadow-sm">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800">Người Dùng Mới Theo Ngày</h3>
                            <p class="text-sm text-gray-500">7 ngày gần nhất</p>
                        </div>
                        <div class="text-right">
                            <p class="text-sm font-medium text-gray-500">Tổng Số Người Dùng Mới</p>
                            <p id="daily-new-users-total" class="text-xl font-bold text-blue-600">0</p>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="usersChart"></canvas>
                    </div>
                </div>

                <!-- Revenue Chart -->
                <div class="bg-white p-6 rounded-2xl shadow-sm">
                    <h3 class="text-lg font-semibold text-gray-800">Doanh Thu Theo Tuần</h3>
                    <p class="text-sm text-gray-500 mb-4">Dữ liệu các tuần đã qua </p>
                    <div class="chart-container">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- DỮ LIỆU MẪU ---
            const mockData = {
                users: [
                    ...Array.from({ length: 55 }, (_, i) => ({ id: i + 1, type: 'student' })),
                    ...Array.from({ length: 17 }, (_, i) => ({ id: i + 56, type: 'teacher' })),
                ],
                loginLogs: new Array(296).fill(0),
                totalClasses: 16,
                totalCourses: 5,
                        dailyNewUsers: {
            labels: ['T2', 'T3', 'T4', 'T5', 'T6', 'T7', 'CN'],
            data: [7, 8, 10, 9, 8, 8, 7]
        },
                weeklyRevenue: {
                    labels: ['Tuần 1', 'Tuần 2'],
                    data: [0, 0]
                }
            };

            // --- LẤY CÁC PHẦN TỬ DOM ---
            const totalUsersEl = document.getElementById('total-users');
            const totalVisitsEl = document.getElementById('total-visits');
            const totalClassesEl = document.getElementById('total-classes');
            const totalCoursesEl = document.getElementById('total-courses');
            const usersChartCanvas = document.getElementById('usersChart').getContext('2d');
            const revenueChartCanvas = document.getElementById('revenueChart').getContext('2d');
            const filterButtons = document.querySelectorAll('.filter-btn');
            const dailyNewUsersTotalEl = document.getElementById('daily-new-users-total');

            // --- CẬP NHẬT GIAO DIỆN ---
            function updateUserStats(filter = 'all') {
                let usersToShow = mockData.users;
                if (filter === 'student') {
                    usersToShow = mockData.users.filter(u => u.type === 'student');
                } else if (filter === 'teacher') {
                    usersToShow = mockData.users.filter(u => u.type === 'teacher');
                }
                totalUsersEl.textContent = usersToShow.length;
            }

            // --- KHỞI TẠO BIỂU ĐỒ ---
            const usersChart = new Chart(usersChartCanvas, {
                type: 'line',
                data: {
                    labels: mockData.dailyNewUsers.labels,
                    datasets: [{
                        label: 'Người Dùng Mới',
                        data: mockData.dailyNewUsers.data,
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: true } },
                    plugins: { legend: { display: false } }
                }
            });

            const revenueChart = new Chart(revenueChartCanvas, {
                type: 'bar',
                data: {
                    labels: mockData.weeklyRevenue.labels,
                    datasets: [{
                        label: 'Doanh Thu',
                        data: mockData.weeklyRevenue.data,
                        backgroundColor: 'rgba(16, 185, 129, 0.6)',
                        borderColor: 'rgba(16, 185, 129, 1)',
                        borderWidth: 1,
                        borderRadius: 5,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { callback: function(value) { return value + ' Tr'; } }
                        }
                    },
                    plugins: { legend: { display: false } }
                }
            });

            // --- GÁN SỰ KIỆN ---
            filterButtons.forEach(button => {
                button.addEventListener('click', () => {
                    filterButtons.forEach(btn => {
                        btn.classList.remove('bg-blue-500', 'text-white');
                        btn.classList.add('bg-gray-200', 'text-gray-700');
                    });
                    button.classList.add('bg-blue-500', 'text-white');
                    button.classList.remove('bg-gray-200', 'text-gray-700');
                    updateUserStats(button.id.split('-')[1]);
                });
            });

            // --- KHỞI CHẠY LẦN ĐẦU ---
            function init() {
                updateUserStats();
                totalVisitsEl.textContent = mockData.loginLogs.length;
                totalClassesEl.textContent = mockData.totalClasses;
                totalCoursesEl.textContent = mockData.totalCourses;
                const dailyNewUsersSum = mockData.dailyNewUsers.data.reduce((a, b) => a + b, 0);
                dailyNewUsersTotalEl.textContent = dailyNewUsersSum;
            }

            init();
        });
    </script>
</body>
</html>


